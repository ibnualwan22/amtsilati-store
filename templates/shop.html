<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amtsilati Store - Katalog Kitab</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: #f0f2f5; }
        .header { background-color: #fff; padding: 1.5em; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-bottom: 3px solid #007bff; }
        .header h1 { margin: 0; color: #007bff; }
        .header p { margin: 0.5em 0 0; color: #606770; }
        .container { max-width: 1200px; margin: 2em auto; padding: 0 1em; }
        .search-container { margin-bottom: 2em; }
        #search-box { width: 100%; padding: 1em; font-size: 1em; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5em; }
        .book-card { background-color: #ffffff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); overflow: hidden; transition: transform 0.3s ease, box-shadow 0.3s ease; display: flex; flex-direction: column; }
        .book-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15); }
        .book-card.out-of-stock { filter: grayscale(100%); opacity: 0.7; }
        .book-card.out-of-stock:hover { transform: none; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        .book-card-image { width: 100%; height: 250px; background-color: #e9ecef; display: flex; align-items: center; justify-content: center; color: #6c757d; overflow: hidden; }
        .book-card-image img { width: 100%; height: 100%; object-fit: cover; }
        .book-card-content { padding: 1.5em; flex-grow: 1; display: flex; flex-direction: column; }
        .book-card-title { font-size: 1.25em; font-weight: 600; margin: 0 0 0.5em; }
        .book-card-price { font-size: 1.5em; font-weight: 700; color: #007bff; margin: auto 0 1em; }
        .book-card-actions { margin-top: auto; }
        .btn { display: block; width: 100%; padding: 0.8em; text-align: center; text-decoration: none; border-radius: 8px; font-weight: 600; transition: background-color 0.3s ease; }
        .btn-details { background-color: #007bff; color: white; }
        .btn-details:hover { background-color: #0056b3; }
        .btn-disabled { background-color: #6c757d; color: #fff; cursor: not-allowed; }
        .footer { text-align: center; padding: 2em; margin-top: 2em; color: #606770; }
    </style>
</head>
<body>

    <header class="header">
        <h1>Amtsilati Store</h1>
        <p>Menyediakan Berbagai Macam Kitab Metode Amtsilati dan Pesantren</p>
    </header>

    <main class="container">
        <div class="search-container">
            <input type="text" id="search-box" placeholder="Cari nama kitab...">
        </div>

        <div class="grid-container">
            {% for book in books %}
            <div class="book-card {% if book.availability != 'Tersedia' %}out-of-stock{% endif %}">
                <div class="book-card-image">
                    {% if book.image_filename %}
                        <!-- PERBAIKAN: Tambahkan 'onerror' untuk menangani gambar yang rusak -->
                        <img src="{{ url_for('uploaded_file', filename=book.image_filename) }}" 
                             alt="Foto {{ book.name }}" 
                             onerror="this.onerror=null; this.src='https://placehold.co/400x600/e2e8f0/4a5568?text=Gagal+Muat';">
                    {% else %}
                        <span>[Gambar Kitab]</span>
                    {% endif %}
                </div>
                <div class="book-card-content">
                    <h3 class="book-card-title">{{ book.name }}</h3>
                    <p class="book-card-price">Rp {{ book.price | rupiah }}</p>
                    <div class="book-card-actions">
                        {% if book.availability == 'Tersedia' %}
                            <a href="{{ url_for('book_detail', book_id=book.id) }}" class="btn btn-details">Lihat Detail & Beli</a>
                        {% else %}
                            <a href="#" class="btn btn-disabled" onclick="return false;">Stok Habis</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2025 Amtsilati Store. All Rights Reserved.</p>
        <p><a href="{{ url_for('login') }}" style="color: #606770; text-decoration: none;">Admin Login</a></p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchBox = document.getElementById('search-box');
            const bookCards = document.querySelectorAll('.book-card');

            searchBox.addEventListener('input', function() {
                const searchTerm = searchBox.value.toLowerCase();

                bookCards.forEach(function(card) {
                    const titleElement = card.querySelector('.book-card-title');
                    const title = titleElement.textContent.toLowerCase();

                    if (title.includes(searchTerm)) {
                        card.style.display = 'flex';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        });
    </script>

</body>
</html>
